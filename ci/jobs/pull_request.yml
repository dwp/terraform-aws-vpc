jobs:
- name: terraform-aws-vpc-pr
  plan:
  - get: terraform-aws-vpc-pr
    trigger: true
    version: every
  - put: terraform-aws-vpc-pr
    params:
      context: $BUILD_JOB_NAME
      path: terraform-aws-vpc-pr
      status: pending
  - .: (( inject meta.plan.terraform-bootstrap ))
    params:
      DEPLOY_PATH: app
    input_mapping:
      terraform-aws-vpc: terraform-aws-vpc-pr
  - task: terraform-plan-app
    .: (( inject meta.plan.terraform-common-config ))
    config:
      run:
        path: sh
        dir: terraform-aws-vpc/example
        args:
        - -exc
        - |
          cp *.tf .
          terraform init
          terraform workspace show
          terraform plan -var assume_role=ci
      inputs:
      - name: terraform-aws-vpc
    input_mapping:
      terraform-aws-vpc: terraform-aws-vpc-pr
    on_failure:
      put: terraform-aws-vpc-pr
      params:
        context: $BUILD_JOB_NAME
        path: terraform-aws-vpc-pr
        status: failure
    on_success:
      put: terraform-aws-vpc-pr
      params:
        context: $BUILD_JOB_NAME
        path: terraform-aws-vpc-pr
        status: success
